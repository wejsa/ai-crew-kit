# {{PROJECT_NAME}}

## 프로젝트 개요

{{PROJECT_DESCRIPTION}}

### 기술 스택
{{TECH_STACK_SECTION}}

### 도메인
- **유형**: {{DOMAIN_NAME}} ({{DOMAIN_ID}})
- **컴플라이언스**: {{DOMAIN_COMPLIANCE}}

---

## 세션 시작 시 필수

```bash
# 1. 최신 상태 동기화
GIT_DIR=$(git rev-parse --git-dir 2>/dev/null)
GIT_COMMON_DIR=$(git rev-parse --git-common-dir 2>/dev/null)
if [ "$GIT_DIR" != "$GIT_COMMON_DIR" ]; then
  # Worktree 모드 (Claude Squad 등)
  git fetch origin develop
  git merge origin/develop
else
  git checkout develop
  git pull origin develop
fi

# 2. 이전 세션 연속 계획 확인
#    .claude/temp/continuation-plan.md 존재 시 → 파일 읽고 남은 작업부터 자동 재개
#    존재하지 않으면 → 아래 3, 4번 진행

# 3. 상태 요약 보기
/skill-status

# 4. 다음 작업 가져오기
/skill-plan
```

---

## 상태 관리 (Git 기반 SSOT)

```
.claude/state/              # Git 관리
├── project.json            # 프로젝트 설정 (도메인, 스택, 에이전트)
├── backlog.json            # 백로그 + 상태 + Phase
└── completed.json          # 완료 이력

.claude/temp/               # 임시 파일 (Git 제외)
└── {taskId}-plan.md        # Task별 상세 계획
```

**Git clone/pull이 곧 동기화입니다.**

---

## 에이전트

{{AGENTS_SECTION}}

---

## 주요 스킬

```bash
/skill-status         # 상태 확인
/skill-backlog        # 백로그 조회
/skill-feature        # 새 기능 기획 (요구사항 + backlog 등록)
/skill-plan           # 다음 작업 + 설계 + 스텝 분리 계획 수립
/skill-impl           # 스텝 개발 + PR 생성
/skill-review         # 코드 리뷰
/skill-review-pr {num}  # PR 코드 리뷰
/skill-merge-pr {num}   # PR 머지
/skill-docs           # 참고자료
/skill-retro          # 완료 Task 회고 + 학습 반영
/skill-hotfix         # main 긴급 수정
/skill-rollback       # 릴리스 롤백
/skill-report         # 프로젝트 메트릭 리포트
/skill-onboard        # 기존 프로젝트 온보딩
/skill-estimate       # 작업 복잡도 추정
/skill-create         # 커스텀 스킬 생성
```

---

## 자연어 명령어

| 자연어 | 스킬 | 동작 |
|--------|------|------|
| "상태 확인해줘" | `/skill-status` | 프로젝트 상태 확인 |
| "백로그 보여줘" | `/skill-backlog` | 백로그 조회 |
| "다음 작업 가져와줘" | `/skill-plan` | Task 선택 + 설계 + 스텝 계획 |
| "새 기능 기획해줘: {기능명}" | `/skill-feature {기능명}` | 새 기능 기획 + 요구사항 문서 |
| "개발 진행해줘" | `/skill-impl` | Step 1 개발 -> PR 생성 |
| "다음 스텝 진행해줘" | `/skill-impl --next` | 다음 스텝 개발 -> PR 생성 |
| "전체 개발 진행해줘" | `/skill-impl --all` | 모든 스텝 연속 개발 |
| "{경로} 코드 리뷰해줘" | `/skill-review {경로}` | 코드 경로 종합 리뷰 |
| "PR {번호} 리뷰해줘" | `/skill-review-pr {번호}` | PR 리뷰 |
| "PR {번호} 머지해줘" | `/skill-merge-pr {번호}` | PR 머지 |
| "회고 해줘" | `/skill-retro` | 최근 완료 Task 회고 |
| "전체 회고 요약해줘" | `/skill-retro --summary` | 전체 회고 요약 |
| "긴급 수정해줘: {설명}" | `/skill-hotfix "{설명}"` | main 긴급 수정 |
| "{태그} 롤백해줘" | `/skill-rollback {태그}` | 릴리스/PR 롤백 |
| "리포트 생성해줘" | `/skill-report` | 프로젝트 메트릭 리포트 |
| "이 프로젝트에 적용해줘" | `/skill-onboard` | 기존 프로젝트 온보딩 |
| "이 작업 얼마나 걸려?" | `/skill-estimate {TASK-ID}` | 작업 복잡도 추정 |
| "스프린트 플래닝 해줘" | `/skill-estimate --sprint` | 스프린트 플래닝 |
| "커스텀 스킬 만들어줘: {name}" | `/skill-create {name}` | 커스텀 스킬 생성 |

{{DOMAIN_DOCS_MAPPING}}

---

## 자동 연속 실행 규칙 (필수)

스킬 완료 후 조건 충족 시 **반드시** 다음 스킬을 자동 호출한다. 멈추거나 질문하지 않는다.

| 완료 스킬 | 조건 | 자동 호출 |
|-----------|------|----------|
| skill-impl | PR 생성 완료 | → skill-review-pr {PR번호} --auto-fix |
| skill-review-pr | APPROVED | → skill-merge-pr {PR번호} |
| skill-review-pr | REQUEST_CHANGES | ❌ 멈춤 (수정 대기) |
| skill-merge-pr | 남은 스텝 있음 | → skill-impl --next |
| skill-merge-pr | 마지막 스텝 | Task 완료 처리 후 종료 |
| skill-plan | 사용자 "Y" 승인 | → skill-impl |
| skill-hotfix | - | 자동 체이닝 없음 (독립 실행) |
| skill-rollback | - | 자동 체이닝 없음 (독립 실행) |
| skill-retro | - | 자동 체이닝 없음 (독립 실행) |
| skill-report | - | 자동 체이닝 없음 (독립 실행) |
| skill-onboard | - | 자동 체이닝 없음 (독립 실행) |
| skill-estimate | - | 자동 체이닝 없음 (독립 실행) |
| skill-create | - | 자동 체이닝 없음 (독립 실행) |

### --all 옵션
`/skill-impl --all` 사용 시 모든 스텝을 사용자 개입 없이 연속 실행.

### 중단 조건 (이 경우에만 멈추고 사용자에게 보고)
- CRITICAL 이슈 auto-fix 실패
- 빌드 실패 (3회 재시도 후)
- 라인 수 700 초과 (스텝 분리 필요)

### 금지 사항
- 자동 호출 대상인데 "진행할까요?" 질문하며 멈추기 **금지**
- Skill tool 없이 직접 실행 **금지** (반드시 `Skill tool` 사용)
- 에러/REQUEST_CHANGES 외 상황에서 멈추기 **금지**

---

## 컨텍스트 한계 관리 (필수)

컨텍스트 사용량이 **70% 이상**이 되면 현재 작업을 즉시 중단하고 **연속 계획 파일**을 작성한 뒤 세션을 종료한다.

### 트리거 조건
- 컨텍스트 사용량 70% 이상 도달 시 (시스템이 컨텍스트 압축 경고를 보내기 전)
- 현재 진행 중인 도구 호출이 끝난 직후 실행

### 실행 절차

1. **현재 작업 안전하게 중단**
   - 작성 중인 코드가 있으면 현재 파일까지만 저장/커밋
   - PR 생성 전이면 WIP 커밋으로 저장
   - PR 리뷰/머지 중이면 현재 단계까지 완료

2. **연속 계획 파일 작성** → `.claude/temp/continuation-plan.md`
   ```markdown
   # 연속 작업 계획

   ## 세션 종료 시점
   - 일시: {현재 시각}
   - 종료 사유: 컨텍스트 70% 도달

   ## 현재 상태
   - Task: {{{TASK_PREFIX}}-XXX}
   - 현재 Step: {N} / 전체 {M} 스텝
   - 브랜치: {현재 브랜치명}
   - PR: {PR 번호 또는 "미생성"}
   - PR 상태: {OPEN/APPROVED/MERGED 또는 "N/A"}

   ## 완료된 작업
   - {완료한 내용 목록}

   ## 남은 작업
   - {남은 내용 목록 - 구체적으로}

   ## 다음 세션 시작 명령
   ```bash
   # 1. 상태 확인
   cat .claude/temp/continuation-plan.md

   # 2. 이어서 실행할 명령
   {정확한 스킬 명령어}
   ```
   ```

3. **backlog.json 상태 업데이트**
   - 현재 스텝의 진행 상태를 정확히 반영

4. **변경사항 커밋 및 푸시**
   ```
   git add -A && git commit -m "chore: 컨텍스트 한계 도달 - 연속 계획 저장"
   git push
   ```

5. **사용자에게 안내 메시지 출력**
   ```
   ⚠️ 컨텍스트 70% 도달로 세션을 종료합니다.

   📋 연속 계획: .claude/temp/continuation-plan.md
   📌 현재 상태: {{TASK_PREFIX}}-XXX Step N (설명)

   🔄 새 세션에서 아래 명령으로 이어서 진행하세요:
   > {정확한 재개 명령어}
   ```

### 새 세션 시작 시
1. `.claude/temp/continuation-plan.md` 파일 존재 여부 확인
2. 존재하면 파일을 읽고 **남은 작업**부터 자동 재개
3. 재개 완료 후 continuation-plan.md 삭제

### 금지 사항
- 컨텍스트 70% 이상에서 새로운 대규모 작업 시작 **금지**
- 연속 계획 없이 세션 종료 **금지**
- 계획 파일에 모호한 내용 작성 **금지** (새 세션이 즉시 실행 가능해야 함)

---

## 워크플로우

### 새 기능 (기획부터)

```
/skill-feature "기능명"
  ↓
요구사항 정의 -> docs/requirements/{{TASK_PREFIX}}-XXX-spec.md
  ↓
사용자 검토/승인
  ↓
backlog.json에 Task 등록
  ↓
/skill-plan으로 설계 + 계획 수립
```

### 기존 Task 개발

```
/skill-plan
  ↓
Task 선택 -> 요구사항 확인 -> 설계 -> 스텝 분리 계획
  ↓
(사용자 설계/계획 검토)
  ↓
/skill-impl 또는 "개발 진행해줘"
  ↓
Step 1 개발 -> PR 자동 생성
  ↓
/skill-review-pr {번호} 또는 "PR {번호} 리뷰해줘"
  ↓
(수정 필요 시 수정 -> 커밋 -> 푸시)
  ↓
/skill-merge-pr {번호} 또는 "PR {번호} 머지해줘"
  ↓
/skill-impl --next 또는 "다음 스텝 진행해줘"
  ↓
(반복)
  ↓
마지막 스텝 머지 -> 전체 완료
```

### 긴급 수정 워크플로우

```
"긴급 수정해줘: {설명}" 또는 "v1.2.3 롤백해줘"
        │
        ├── [수정] /skill-hotfix
        │     ├── main에서 hotfix 브랜치 분기
        │     ├── 코드 수정 + 빌드/테스트
        │     ├── PR 생성 (--base main) + 보안 리뷰
        │     ├── 머지 → 패치 버전 범프 → 태그
        │     └── develop 백머지
        │
        └── [롤백] /skill-rollback
              ├── main에서 revert 브랜치 분기
              ├── git revert (히스토리 보존)
              ├── Revert PR 생성 (--base main)
              ├── 머지 → 패치 버전 범프 → 태그
              └── develop 백머지
```

---

## Git 브랜치 전략

### 브랜치 구조
```
main (운영)
  ├── hotfix/HOT-NNN-긴급수정 (main에서 분기 → main PR)
  ├── revert/{대상} (main에서 분기 → main PR)
  └── develop (개발 통합)
        ├── feature/{{TASK_PREFIX}}-XXX-stepN (스텝별 개발)
        └── bugfix/{{TASK_PREFIX}}-XXX-버그명 (버그 수정)
```

### PR 규칙
- PR은 develop 브랜치로 생성
- 리뷰 승인 후 Squash 머지
- **스텝별 PR 생성** ({{PR_LINE_LIMIT}}라인 미만 단위)
- PR 생성: `/skill-impl` 스텝 완료 시 자동 처리
- PR 리뷰: `/skill-review-pr {번호}`
- PR 머지: `/skill-merge-pr {번호}`

### 커밋 메시지 규칙
```
<type>: <description>

Types:
- feat: 새 기능
- fix: 버그 수정
- refactor: 리팩토링
- docs: 문서
- test: 테스트
- chore: 기타

예: feat: {{TASK_PREFIX}}-010 Step 1 - 서비스 구현
```

---

## Task 개발 규칙

### 작업 ID 체계
```
{{TASK_PREFIX}}-{번호}

예: {{TASK_PREFIX}}-001, {{TASK_PREFIX}}-010
```

### 스텝 분리 기준
- 각 스텝은 **수정 라인 {{PR_LINE_LIMIT}}라인 미만**으로 제한
- 세부 계획을 스텝 단위로 명확히 구분

### 라인 수 제한

| 라인 수 | 처리 |
|---------|------|
| < 300 | 양호 |
| 300~500 | 경고 (계속 진행 가능) |
| 500~700 | 강력 경고 (사용자 확인 필요) |
| > 700 | 차단 (반드시 스텝 분리) |

---

{{CONVENTIONS_SECTION}}

---

{{DOMAIN_ERROR_CODES}}

---

## 테스트 규칙

### 커버리지 목표
- 단위 테스트: {{TEST_COVERAGE}}%+
- 통합 테스트: 주요 플로우 100%

---

## 산출물 저장 위치

```
docs/
├── requirements/         # 요구사항 문서
├── api-specs/            # API 명세 (OpenAPI)
├── architecture/         # 아키텍처 문서
├── security/             # 보안 문서
├── test-plans/           # 테스트 계획
├── retro/                # 회고 리포트
└── reports/              # 메트릭 리포트
```

---

<!-- CUSTOM_SECTION_START -->
{{CUSTOM_SECTION}}
<!-- CUSTOM_SECTION_END -->

---
name: skill-review
description: 코드 리뷰 - 지정 경로의 코드를 5관점 통합 리뷰
disable-model-invocation: true
allowed-tools: Bash(git:*), Read, Glob, Grep, Task
argument-hint: "[경로]"
---

# skill-review: 코드 리뷰

## 실행 조건
- 사용자가 `/skill-review {경로}` 또는 "{경로} 코드 리뷰해줘" 요청 시

## 실행 플로우

### 1. 리뷰 대상 파일 수집
```bash
# 단일 파일
/skill-review src/main/kotlin/com/example/Service.kt

# 디렉토리
/skill-review src/main/kotlin/com/example/

# 패턴
/skill-review src/**/*Service.kt
```

### 2. 코드 분석
대상 파일 읽기 및 분석:
- 파일 구조 파악
- 의존성 확인
- 테스트 파일 매칭

### 3. @agent-reviewer 5관점 검토

**도메인 체크리스트 동적 로딩**:
1. `.claude/state/project.json`에서 현재 도메인 확인
2. `.claude/domains/_base/checklists/*.md` 로드 (공통)
3. `.claude/domains/{domain}/checklists/*.md` 로드 (도메인별)
4. 중복 항목은 도메인 설정이 우선

#### 1️⃣ 컴플라이언스 관점
| 체크 항목 | 설명 |
|----------|------|
| 규정 준수 | 업종별 규정 (금융: PCI-DSS, 전자금융감독규정 등) |
| 감사 로그 | 중요 작업 로깅, 로그 무결성 |
| 민감정보 암호화 | 개인정보, 인증정보 암호화 |
| 데이터 보존 | 법적 보존 기간 준수 |

#### 2️⃣ 도메인 관점
| 체크 항목 | 설명 |
|----------|------|
| 비즈니스 로직 | 요구사항 충족, 엣지 케이스 처리 |
| 상태 머신 | 상태 전이 정확성, 무효 전이 방지 |
| 데이터 일관성 | 트랜잭션 경계, 동시성 처리 |
| 도메인 모델 | 적절한 모델링, 책임 분리 |

#### 3️⃣ 아키텍처 관점
| 체크 항목 | 설명 |
|----------|------|
| 설계 패턴 | 적절한 패턴 사용, 일관성 |
| 장애 격리 | Circuit Breaker, Timeout, Retry |
| 확장성 | 수평 확장 가능, 병목 없음 |
| 의존성 | 순환 의존 없음, 적절한 추상화 |

#### 4️⃣ 보안 관점
| 체크 항목 | 설명 |
|----------|------|
| 인증/인가 | 적절한 접근 제어 |
| 입력 검증 | SQL Injection, XSS 방지 |
| 민감정보 노출 | 로그, 에러 메시지에 민감정보 없음 |
| Rate Limiting | 과도한 요청 방지 |

#### 5️⃣ 테스트 품질 관점
| 체크 항목 | 설명 |
|----------|------|
| 커버리지 | 80% 이상 권장 |
| 실패 케이스 | 예외 상황 테스트 |
| 동시성 테스트 | 멀티스레드 안전성 |
| 통합 테스트 | 컴포넌트 간 상호작용 |

### 4. 이슈 분류

#### 심각도 레벨
| 레벨 | 설명 | 조치 |
|------|------|------|
| 🔴 CRITICAL | 보안 취약점, 데이터 손실 가능 | 즉시 수정 필수 |
| 🟠 MAJOR | 기능 오류, 성능 문제 | 수정 권장 |
| 🟡 MINOR | 코드 품질, 컨벤션 | 개선 권장 |
| 🔵 INFO | 제안, 참고사항 | 선택적 |

### 5. 리뷰 결과 출력

```
## 📝 코드 리뷰: {경로}

### 리뷰 대상
- 파일: {N}개
- 총 라인: {N}

### 요약
| 관점 | 상태 | 이슈 |
|------|------|------|
| 1️⃣ 컴플라이언스 | ✅/⚠️/❌ | {N}개 |
| 2️⃣ 도메인 | ✅/⚠️/❌ | {N}개 |
| 3️⃣ 아키텍처 | ✅/⚠️/❌ | {N}개 |
| 4️⃣ 보안 | ✅/⚠️/❌ | {N}개 |
| 5️⃣ 테스트 | ✅/⚠️/❌ | {N}개 |

### 이슈 목록

#### 🔴 CRITICAL
**[C001] {파일}:{라인} - {제목}**
- 관점: {관점}
- 설명: {상세 설명}
- 수정 방안: {권장 수정}

#### 🟠 MAJOR
**[M001] {파일}:{라인} - {제목}**
...

#### 🟡 MINOR
**[m001] {파일}:{라인} - {제목}**
...

### 개선 권장사항
1. {권장 1}
2. {권장 2}

### 결론
- **승인 가능**: {Yes/No}
- **필수 수정**: {N}개
- **권장 수정**: {N}개
```

## 자동 수정 제안
CRITICAL/MAJOR 이슈에 대해 수정 코드 제안:
```kotlin
// Before
{문제 코드}

// After (권장)
{수정 코드}
```

## 에이전트 호출
복잡한 리뷰 시 `@agent-reviewer` 에이전트 활용:
```
Task: pr-review-toolkit:code-reviewer
또는 프로젝트별 커스텀 리뷰어 에이전트
```

## 주의사항
- 리뷰는 코드 수정 없이 분석만 수행
- CRITICAL 이슈 발견 시 즉시 알림
- 자동 수정은 사용자 승인 후에만 적용
